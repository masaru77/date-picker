<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>Click用カレンダー API対応 完全版</title>

  <!-- FlatpickrのCSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
      padding: 20px;
      background: #f8f9fa;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 8px;
    }
    input[type="text"] {
      padding: 8px;
      font-size: 16px;
      width: 250px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .status {
      margin-top: 12px;
      font-size: 14px;
      color: #555;
    }
  </style>
</head>
<body>

  <h2>日付入力（Click API対応）</h2>

  <label for="datepicker">日付を選択してください</label>
  <!-- Flatpickrを適用する入力欄 -->
  <input type="text" id="datepicker" placeholder="日付を選択">

  <!-- 処理ステータス表示 -->
  <div class="status" id="status">未送信</div>

  <!-- Flatpickr本体 -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    // ▼ここをClickのAPI情報に差し替える
    const CLICK_API_ENDPOINT = "https://example.click.com/api/v1/data"; // ← 実際のエンドポイント
    const CLICK_API_KEY = "xxxxxxxxxxxxxxxxxxxxxxxx"; // ← ClickのAPIキー
    const CLICK_FIELD_NAME = "date_field"; // ← Clickフォームのname属性に一致させる

    // Flatpickrを初期化
    flatpickr("#datepicker", {
      dateFormat: "Y-m-d",
      locale: "ja",
      minDate: "today",   // 今日以降のみ選択可
      disableMobile: true,
      onChange: function(selectedDates, dateStr) {
        if (dateStr) {
          sendToClick(dateStr);
        }
      }
    });

    // API経由でClickにデータ送信
    async function sendToClick(dateStr) {
      const statusEl = document.getElementById("status");
      statusEl.textContent = "送信中…";

      try {
        const response = await fetch(CLICK_API_ENDPOINT, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${CLICK_API_KEY}`
          },
          body: JSON.stringify({
            [CLICK_FIELD_NAME]: dateStr
          })
        });

        if (!response.ok) {
          throw new Error("送信失敗: " + response.status);
        }

        const result = await response.json();
        statusEl.textContent = "送信成功: " + JSON.stringify(result);

      } catch (error) {
        statusEl.textContent = "エラー: " + error.message;
      }
    }
  </script>
</body>
</html>
